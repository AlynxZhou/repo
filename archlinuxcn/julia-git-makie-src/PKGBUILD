pkgname=julia-git-makie-src
pkgver=0.24.6
_commit=d8f53444bc7d328d351d3265b1380d279eb2058b
pkgrel=1
pkgdesc="Makie.jl"
url="https://github.com/MakieOrg/Makie.jl.git"
arch=('any')
license=('MIT')
makedepends=(git julia-pkg-scripts wget)
depends=(julia-git)
source=("git+https://github.com/MakieOrg/Makie.jl.git#commit=$_commit")
sha256sums=('75692e2c421d8ce33d90776a39c9878673204ef8cec6b405a0516032e9b309a1')

build() {
  cd Makie.jl/Makie

  local url
  url=$(sed -ne '/url *= *".*"/{s/ *url *= *"\(.*\)" */\1/p;q}' Artifacts.toml)

  wget -O MakieAssets.tar.gz "$url"

  (
    rm -rf assets/
    mkdir assets/
    cd assets/
    tar xf ../MakieAssets.tar.gz
    rm ../MakieAssets.tar.gz
  )

  sed -i -e 's|artifact"MakieAssets"|joinpath(@__DIR__, "../assets")|' src/Makie.jl
}

package() {
  cd Makie.jl/Makie

  JULIA_INSTALL_SRCPKG=1 . /usr/lib/julia/julia-install-pkg.sh Makie "${pkgdir}" "${pkgname}" julia-git
}
