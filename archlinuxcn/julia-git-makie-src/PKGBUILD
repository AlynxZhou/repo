pkgname=julia-git-makie-src
pkgver=0.24.5
_commit=4ded556b570b54010e71f1639b0af14546d66e8e
pkgrel=0
pkgdesc="Makie.jl"
url="https://github.com/MakieOrg/Makie.jl.git"
arch=('any')
license=('MIT')
makedepends=(git julia-pkg-scripts wget)
depends=(julia-git)
source=("git+https://github.com/MakieOrg/Makie.jl.git#commit=$_commit")
sha256sums=('e8a1fc0cbba313391d17795ae4e7cf6f8e21040cfc113a7a2efdc9af5a6464c5')

build() {
  cd Makie.jl/Makie

  local url
  url=$(sed -ne '/url *= *".*"/{s/ *url *= *"\(.*\)" */\1/p;q}' Artifacts.toml)

  wget -O MakieAssets.tar.gz "$url"

  (
    rm -rf assets/
    mkdir assets/
    cd assets/
    tar xf ../MakieAssets.tar.gz
    rm ../MakieAssets.tar.gz
  )

  sed -i -e 's|artifact"MakieAssets"|joinpath(@__DIR__, "../assets")|' src/Makie.jl
}

package() {
  cd Makie.jl/Makie

  JULIA_INSTALL_SRCPKG=1 . /usr/lib/julia/julia-install-pkg.sh Makie "${pkgdir}" "${pkgname}" julia-git
}
